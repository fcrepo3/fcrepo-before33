<?xml version="1.0" encoding="UTF-8"?>

<!--
  $Id$

  TODO: Add optimized targets (separate output area)
        Finish doc targets
        Add server targets, similar to client, pulling off common classes
-->

<project name="Fedora" default="all" basedir=".">

  <property name="javaClassDebug" value="on"/>
  <property name="javaClassOptimize" value="off"/>

  <property name="javaSourceDir" value="src/java"/>
  <property name="docDir" value="apidoc"/>

  <target name="all"
          depends="client"
          description="Build all distributions">
  </target>

  <target name="client"
          depends="clientclasses,clienthelp,clientimages,clientjarincludes"
          description="Client distribution">
    <mkdir dir="dist"/>
    <mkdir dir="dist/client"/>
    <jar jarfile="dist/client/client.jar"
         basedir="temp/client"
         manifest="src/mfs/client.mfs"/>
    <mkdir dir="dist/client/lib"/>
    <copy file="lib/client/jhbasic.jar" todir="dist/client/lib"/>
    <copy file="lib/client/rms.jar" todir="dist/client/lib"/>
    <!--<copy todir="temp/client">
      <fileset dir="inc/client/dist"/>
    </copy>-->
    <echo message="Finished building client distribution in dist/client"/>
  </target>

  <target name="runclient"
          depends="client"
          description="run the client">
    <exec dir="dist/client" executable="java">
      <arg line="-jar client.jar"/>
    </exec>
  </target>

  <target name="prep"
          description="Prepare a temporary build area for targets">
    <mkdir dir="temp"/>
  </target>

  <target name="clientprep"
          depends="prep"
          description="Prepare a temporary build area for client-related targets">
    <mkdir dir="temp/client"/>
  </target>

  <target name="clientclasses"
          depends="clientprep"
          description="Compile client java code into temp/client">
    <javac srcdir="${javaSourceDir}"
           destdir="temp/client"
           classpath="lib/client/jhbasic.jar;lib/client/rms.jar"
           includes="edu/cornell/dlrg/swing/mdi/**,edu/cornell/dlrg/swing/jhelp/**,fedora/client/**"
           optimize="${javaClassOptimize}"
           debug="${javaClassDebug}"/>
  </target>

  <target name="clienthelp"
          depends="clientprep"
          description="Assemble JavaHelp for client into temp/client/help">
    <mkdir dir="temp/client/help"/>
    <copy todir="temp/client/help">
      <fileset dir="src/gif/client/help"/>
      <fileset dir="src/jpg/client/help"/>
      <fileset dir="src/html/client/help"/>
      <fileset dir="src/jhelpset/client/help"/>
      <fileset dir="src/jhelptoc/client/help"/>
      <fileset dir="src/jhelpindex/client/help"/>
      <fileset dir="src/jhelpmap/client/help"/>
    </copy>
  </target>

  <target name="clientimages"
          depends="clientprep"
          description="Assemble client images dir sources into temp/client/images">
    <mkdir dir="temp/client/images"/>
    <copy todir="temp/client/images">
      <fileset dir="src/gif/client/images"/>
    </copy>
  </target>

  <target name="clientjarincludes"
          depends="clientprep"
          description="Assemble client includes temp/client">
    <copy todir="temp/client">
      <fileset dir="inc/client/jar"/>
    </copy>
  </target>


<!--
  <target name="docs"
          description="Build dev docs and user docs">
  </target>

  <target name="apidoc"
          description="Build the javadocs">
    <mkdir dir="apidoc"/>
    <javadoc packagenames="edu.cornell.dlrg.swing.mdi.*,edu.cornell.dlrg.swing.jhelp.*,fedora.client.*,fedora.common.*"
             sourcepath="${javaSourceDir}"
             destdir="apidoc"
             author="true"
             version="true"
             use="true"/>
  </target>
-->

  <target name="devdocs"
          depends="prep"
          description="Assemble development/system documentation into dist/devdocs">
    <mkdir dir="dist"/>
    <mkdir dir="dist/devdocs"/>
    <echo message="Copying docs that don't need translation"/>
    <copy todir="dist/devdocs">
      <fileset dir="src/txt/devdocs"/>
      <fileset dir="src/doc/devdocs"/>
      <fileset dir="src/sdr/devdocs"/>
    </copy>
<!--    <mkdir dir="dist/devdocs/devguide"/> -->
    <echo message="Translating devguide.dbx to html"/>
    <exec executable="java">
      <arg value="-classpath"/>
      <arg path="res/saxon-6.5/saxon.jar;res/docbook-xsl/extensions/saxon65.jar"/>
      <arg value="com.icl.saxon.StyleSheet"/>
      <arg value="-o"/>
      <arg path="dist/devdocs/devguide.html"/>
      <arg path="src/dbx/devdocs/devguide.dbx"/>
      <arg path="res/docbook-xsl/html/docbook.xsl"/>
 <!--     <arg value="saxon.extensions=true"/>
      <arg value="chunk.section.depth=1"/> -->
    </exec>
    <echo message="Translating namespaces.dbx to html"/>
    <exec executable="java">
      <arg value="-classpath"/>
      <arg path="res/saxon-6.5/saxon.jar;res/docbook-xsl/extensions/saxon65.jar"/>
      <arg value="com.icl.saxon.StyleSheet"/>
      <arg value="-o"/>
      <arg path="dist/devdocs/namespaces.html"/>
      <arg path="src/dbx/devdocs/namespaces.dbx"/>
      <arg path="res/docbook-xsl/html/docbook.xsl"/>
    </exec>
  </target>
  
  <target name="debug-wsdl"
          depends="prep"
          description="Produce html reports on the validity of the API-A and API-M wsdl in temp/debug/">
    <mkdir dir="temp/debug"/>
    <echo message="Producing html reports on the validity of API-A and API-M..."/>
    <echo message="Doing API-A..."/>
    <exec executable="java">
      <arg value="-classpath"/>
      <arg path="res/saxon-6.5/saxon.jar"/>
      <arg value="com.icl.saxon.StyleSheet"/>
      <arg value="-o"/>
      <arg path="temp/debug/Fedora-API-A.html"/>
      <arg path="src/wsdl/Fedora-API-A.wsdl"/>
      <arg path="res/wsdl-validator/validate.xsl"/>
    </exec>
    <echo message="Doing API-M..."/>
    <exec executable="java">
      <arg value="-classpath"/>
      <arg path="res/saxon-6.5/saxon.jar"/>
      <arg value="com.icl.saxon.StyleSheet"/>
      <arg value="-o"/>
      <arg path="temp/debug/Fedora-API-M.html"/>
      <arg path="src/wsdl/Fedora-API-M.wsdl"/>
      <arg path="res/wsdl-validator/validate.xsl"/>
    </exec>
  </target>
  
  
  <target name="document-wsdl"
          depends="prep"
          description="Produce html documentation of the API-A and API-M wsdl in temp/wsdldoc/">
    <mkdir dir="temp/wsdldoc"/>
    <echo message="Producing html reports on the validity of API-A and API-M..."/>
    <echo message="Doing API-A..."/>
    <exec executable="java">
      <arg value="-classpath"/>
      <arg path="res/saxon-6.5/saxon.jar"/>
      <arg value="com.icl.saxon.StyleSheet"/>
      <arg value="-o"/>
      <arg path="temp/wsdldoc/Fedora-API-M.html"/>
      <arg path="src/wsdl/Fedora-API-M.wsdl"/>
      <arg path="res/wsdl-documentor/document.xsl"/>
    </exec>
  </target>

  <target name="server"
          depends="serverclasses"
          description="Server distribution">

    <mkdir dir="dist"/>
    <mkdir dir="dist/server"/>
    <copy todir="dist/server">
      <fileset dir="inc/server"/>
    </copy>
    <copy file="src/web-app/web.xml" todir="dist/server/tomcat41/webapps/fedora/WEB-INF"/>
    <copy todir="dist/server/tomcat41/webapps/fedora/WEB-INF/classes">
      <fileset dir="temp/server/classes"/>
    </copy>
    <echo message="Finished building server distribution in dist/server"/>
  </target>

  <target name="serverclasses"
          depends="serverprep"
          description="Compile server java code into temp/server/classes">
    <mkdir dir="temp/server/classes"/>
    <javac srcdir="${javaSourceDir}"
           destdir="temp/server/classes"
           classpath="inc/server/tomcat41/common/lib/servlet.jar"
           includes="fedora/server/**"
           optimize="${javaClassOptimize}"
           debug="${javaClassDebug}"/>
  </target>

  <target name="serverprep"
          depends="prep"
          description="Prepare a temporary build area for server-related targets">
    <mkdir dir="temp/server"/>
  </target>

  <target name="clean"
          description="Clean up all targets and temp files">
    <delete dir="temp"/>
    <delete dir="dist"/>
  </target>

</project>

<!--
  $Log$
  Revision 1.9  2002/07/16 16:20:42  cwilper
  added namespace.dbx translation to html to devdocs target

  Revision 1.8  2002/07/16 14:25:40  cwilper
  added target for server

  Revision 1.7  2002/07/15 19:38:53  cwilper
  First import of wsdl-documenting stuff.  This import includes an ant task
  for doing wsdl documentation, the stylesheet, and a couple fixes to the
  API-A and API-M files (problems discovered while documenting them)

  Revision 1.6  2002/07/12 17:39:57  cwilper
  added task for validating wsdl

  Revision 1.5  2002/05/10 20:39:08  cwilper
  Changed devdocs build back to single-file output... multi-file output is ugly/confusing IMHO

  Revision 1.4  2002/05/09 21:23:06  cwilper
  Changed devdocs target to produce devguide.html
  in chunks rather than one big piece.  Also switched
  xslt to saxon 6.5 since it works better than the
  latest version of xalan for this purpose.

  Revision 1.3  2002/05/03 20:48:54  cwilper
  Added docbook to html target for devdocs

  Revision 1.2  2002/05/03 16:03:32  cwilper
  Client builds now work

-->
